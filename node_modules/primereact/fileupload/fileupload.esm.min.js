import*as e from"react";import{localeOption as t}from"primereact/api";import{Button as n}from"primereact/button";import{Messages as r}from"primereact/messages";import{ProgressBar as l}from"primereact/progressbar";import{Ripple as o}from"primereact/ripple";import{classNames as a,ObjectUtils as i,mergeProps as u,IconUtils as c,DomHandler as s}from"primereact/utils";import{ComponentBase as p}from"primereact/componentbase";import{PlusIcon as m}from"primereact/icons/plus";import{UploadIcon as f}from"primereact/icons/upload";import{TimesIcon as d}from"primereact/icons/times";function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function v(e,t){if("object"!==y(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function b(e){var t=v(e,"string");return"symbol"===y(t)?t:String(t)}function g(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e){if(Array.isArray(e))return E(e)}function O(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function w(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function N(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e){return S(e)||O(e)||w(e)||N()}function P(e){throw new TypeError('"'+e+'" is read-only')}function T(e){if(Array.isArray(e))return e}function j(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}function C(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){return T(e)||j(e,t)||w(e,t)||C()}var F=p.extend({defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,withCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0}}),z=p.extend({defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0}}),D=e.memo(e.forwardRef((function(t,n){var r=z.getProps(t),l=z.setMetaData({props:r}).ptm,o=e.useRef(null),c=a("p-badge p-component",g({"p-badge-no-gutter":i.isNotEmpty(r.value)&&1===String(r.value).length,"p-badge-dot":i.isEmpty(r.value),"p-badge-lg":"large"===r.size,"p-badge-xl":"xlarge"===r.size},"p-badge-".concat(r.severity),null!==r.severity),r.className);e.useImperativeHandle(n,(function(){return{props:r,getElement:function(){return o.current}}}));var s=u({ref:o,style:r.style,className:c},z.getOtherProps(r),l("root"));return e.createElement("span",s,r.value)})));function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=R(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function R(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}D.displayName="Badge";var A=e.memo(e.forwardRef((function(p,y){var v=F.getProps(p),b=I(e.useState([]),2),g=b[0],E=b[1],S=I(e.useState([]),2),O=S[0],w=S[1],N=I(e.useState(0),2),T=N[0],j=N[1],C=I(e.useState(!1),2),z=C[0],x=C[1],R=I(e.useState(!1),2),U=R[0],A=R[1],k=F.setMetaData({props:v,state:{progress:T,uploading:U,uploadedFiles:g,files:O,focused:z}}).ptm,X=e.useRef(null),H=e.useRef(null),J=e.useRef(null),_=e.useRef(!1),V=e.useRef(0),K=i.isNotEmpty(O),Y=i.isNotEmpty(g),W=v.disabled||U,$=v.chooseLabel||v.chooseOptions.label||t("choose"),q=v.uploadLabel||v.uploadOptions.label||t("upload"),G=v.cancelLabel||v.cancelOptions.label||t("cancel"),Z=W||v.fileLimit&&v.fileLimit<=O.length+V,Q=W||!K,ee=W||!K,te=function(e){return/^image\//.test(e.type)},ne=function(e,t){le();var n=B(O),r=O[t];n.splice(t,1),w(n),v.onRemove&&v.onRemove({originalEvent:e,file:r})},re=function(e,t){le();var n=B(g),r=O[t];n.splice(t,1),E(n),v.onRemove&&v.onRemove({originalEvent:e,file:r})},le=function(){X.current&&(X.current.value="")},oe=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},ae=function(e){if(!v.onBeforeSelect||!1!==v.onBeforeSelect({originalEvent:e,files:O}))if("drop"!==e.type&&ue()&&_.current)_.current=!1;else{var t=[];v.multiple&&(t=O?B(O):[]);for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0;r<n.length;r++){var l=n[r];!ie(l)&&ce(l)&&(te(l)&&(l.objectURL=window.URL.createObjectURL(l)),t.push(l))}w(t),i.isNotEmpty(t)&&v.auto&&se(t),v.onSelect&&v.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&ue()?X.current&&(_.current=!0,X.current.value=""):le(),"basic"===v.mode&&t.length>0&&(X.current.style.display="none")}},ie=function(e){return O.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},ue=function(){return!!window.MSInputMethodContext&&!!document.documentMode},ce=function(e){if(v.maxFileSize&&e.size>v.maxFileSize){var t={severity:"error",summary:v.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:v.invalidFileSizeMessageDetail.replace("{0}",oe(v.maxFileSize)),sticky:!0};return"advanced"===v.mode&&H.current.show(t),v.onValidationFail&&v.onValidationFail(e),!1}return!0},se=function(e){if((e=e||O)&&e.nativeEvent&&(e=O),v.customUpload)v.fileLimit&&P("uploadedFileCount"),v.uploadHandler&&v.uploadHandler({files:e,options:{clear:pe,props:v}});else{A(!0);var t=new XMLHttpRequest,n=new FormData;v.onBeforeUpload&&v.onBeforeUpload({xhr:t,formData:n});var r,l=L(e);try{for(l.s();!(r=l.n()).done;){var o=r.value;n.append(v.name,o,o.name)}}catch(e){l.e(e)}finally{l.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);j(t),v.onProgress&&v.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(j(0),A(!1),t.status>=200&&t.status<300?(v.fileLimit&&P("uploadedFileCount"),v.onUpload&&v.onUpload({xhr:t,files:e})):v.onError&&v.onError({xhr:t,files:e}),E((function(t){return[].concat(B(t),B(e))})),pe())},t.open("POST",v.url,!0),v.onBeforeSend&&v.onBeforeSend({xhr:t,formData:n}),t.withCredentials=v.withCredentials,t.send(n)}},pe=function(){w([]),A(!1),v.onClear&&v.onClear(),le()},me=function(){X.current.click()},fe=function(){x(!0)},de=function(){x(!1)},ye=function(e){13===e.which&&me()},ve=function(e){if(!v.disabled&&(s.removeClass(J.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!v.onBeforeDrop||!1!==v.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(v.multiple||i.isEmpty(O)&&t&&1===t.length)&&ae(e)}},be=function(){!W&&K?se():X.current.click()};e.useImperativeHandle(y,(function(){return{props:v,upload:se,clear:pe,formatSize:oe,onFileSelect:ae,getInput:function(){return X.current},getContent:function(){return J.current},getFiles:function(){return O},setFiles:function(e){return w(e||[])}}}));var ge,he,Ee,Se,Oe,we,Ne,Be,Pe,Te,je,Ce,Ie=function(e,t,n){"warning"===t.severity?ne(e,n):re(e,n)},Fe=function(t,r,l){var o=t.name+t.type+t.size,a=u({role:"presentation",className:"p-fileupload-file-thumbnail",src:t.objectURL,width:v.previewWidth},k("thumbnail")),c=te(t)?e.createElement("img",h({},a,{alt:t.name})):null,s=u(k("details")),p=u(k("fileSize")),m=u({className:"p-fileupload-filename"},k("fileName")),f=u(k("actions")),y=e.createElement("div",m,t.name),b=e.createElement("div",p,oe(t.size)),g=e.createElement("div",s,e.createElement("div",m," ",t.name),e.createElement("span",p,oe(t.size)),e.createElement(D,{className:"p-fileupload-file-badge",value:l.value,severity:l.severity,pt:k("badge")})),E=e.createElement("div",f,e.createElement(n,{type:"button",icon:v.removeIcon||e.createElement(d,null),text:!0,rounded:!0,severity:"danger",onClick:function(e){return Ie(e,l,r)},disabled:W,pt:k("removeButton")})),S=e.createElement(e.Fragment,null,c,g,E);if(v.itemTemplate){var O={onRemove:function(e){return ne(e,r)},previewElement:c,fileNameElement:y,sizeElement:b,removeElement:E,formatSize:oe(t.size),element:S,index:r,props:v};S=i.getJSXElement(v.itemTemplate,t,O)}var w=u({key:o,className:"p-fileupload-row"},k("file"));return e.createElement("div",w,S)},ze=function(){var t={severity:"success",value:"Completed"},n=g&&g.map((function(e,n){return Fe(e,n,t)}));return e.createElement("div",null,n)};return"advanced"===v.mode?function(){var t,p,y,b,g,E,S,w,N,B,P,j,C,I,D,x,L,R,U,A,_=a("p-fileupload p-fileupload-advanced p-component",v.className),V=a("p-fileupload-buttonbar",v.headerClassName),te=a("p-fileupload-content",v.contentClassName),ne=(p=(t=v.chooseOptions).style,y=t.icon,g=a("p-button p-fileupload-choose p-component",{"p-disabled":W,"p-focus":z,"p-button-icon-only":b=t.iconOnly},t.className),E=a("p-button-icon p-clickable",{"p-button-icon-left":!b}),S=u({className:"p-button-label p-clickable"},k("chooseButtonLabel")),w=b?e.createElement("span",h({},S,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",S,$),N=u({ref:X,type:"file",onChange:function(e){return ae(e)},multiple:v.multiple,accept:v.accept,disabled:Z},k("input")),B=e.createElement("input",N),P=u({className:E},k("chooseIcon")),j=c.getJSXIcon(y||e.createElement(m,P),M({},P),{props:v}),C=u({className:g,style:p,onClick:me,onKeyDown:function(e){return ye(e)},onFocus:fe,onBlur:de,tabIndex:0},k("chooseButton")),e.createElement("span",C,B,j,w,e.createElement(o,null))),re=!v.emptyTemplate||K||Y?null:i.getJSXElement(v.emptyTemplate,v);if(!v.auto){var le=v.uploadOptions,oe=v.cancelOptions,ie=le.iconOnly?"":q,ue=oe.iconOnly?"":G,ce=a("p-button-icon p-c",{"p-button-icon-left":!le.iconOnly}),be=u({className:ce},k("uploadIcon")),ge=c.getJSXIcon(le.icon||e.createElement(f,be),M({},be),{props:v}),he=a("p-button-icon p-c",{"p-button-icon-left":!oe.iconOnly}),Ee=u({className:he},k("cancelIcon")),Se=c.getJSXIcon(oe.icon||e.createElement(d,Ee),M({},Ee),{props:v});I=e.createElement(n,{type:"button",label:ie,icon:ge,onClick:se,disabled:Q,style:le.style,className:le.className,pt:k("uploadButton")}),D=e.createElement(n,{type:"button",label:ue,icon:Se,onClick:pe,disabled:ee,style:oe.style,className:oe.className,pt:k("cancelButton")})}K&&(U={severity:"warning",value:"Pending"},A=O.map((function(e,t){return Fe(e,t,U)})),x=e.createElement("div",null,A),R=v.progressBarTemplate?i.getJSXElement(v.progressBarTemplate,v):e.createElement(l,{value:T,showValue:!1,pt:k("progressbar")})),Y&&(L=ze());var Oe=u({className:V,style:v.headerStyle},k("buttonbar")),we=e.createElement("div",Oe,ne,I,D);v.headerTemplate&&(we=i.getJSXElement(v.headerTemplate,{className:V,chooseButton:ne,uploadButton:I,cancelButton:D,element:we,props:v}));var Ne=u({id:v.id,className:_,style:v.style},F.getOtherProps(v),k("root")),Be=u({ref:J,className:te,style:v.contentStyle,onDragEnter:function(e){return t=e,void(W||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()));var t},onDragOver:function(e){return t=e,void(W||(t.dataTransfer.dropEffect="copy",s.addClass(J.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault()));var t},onDragLeave:function(e){return t=e,void(W||(t.dataTransfer.dropEffect="copy",s.removeClass(J.current,"p-fileupload-highlight")));var t},onDrop:function(e){return ve(e)}},k("content"));return e.createElement("div",Ne,we,e.createElement("div",Be,R,e.createElement(r,{ref:H}),K?x:null,Y?L:null,re))}():"basic"===v.mode?(ge=v.chooseOptions,he=a("p-fileupload p-fileupload-basic p-component",v.className),Ee=a("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":K,"p-disabled":W,"p-focus":z},ge.className),Se=u({className:"p-button-label p-clickable"},k("label")),Oe=ge.iconOnly?e.createElement("span",h({},Se,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",Se,$),we=v.auto?Oe:e.createElement("span",Se,K?O[0].name:Oe),Ne=a("p-button-icon",{"p-button-icon-left":!ge.iconOnly}),Be=u({className:Ne},k("chooseIcon")),Pe=c.getJSXIcon(ge.icon?ge.icon:ge.icon||K&&!v.auto?!ge.icon&&K&&!v.auto&&e.createElement(f,Be):e.createElement(m,Be),M({},Be),{props:v,hasFiles:K}),Te=!K&&e.createElement("input",{ref:X,type:"file",accept:v.accept,multiple:v.multiple,disabled:W,onChange:ae}),je=u({className:he,style:v.style},F.getOtherProps(v),k("root")),Ce=u({className:Ee,style:ge.style,tabIndex:0,onMouseUp:be,onKeyDown:function(e){return ye(e)},onFocus:fe,onBlur:de},F.getOtherProps(v),k("basicButton")),e.createElement("div",je,e.createElement(r,{ref:H,pt:k("message")}),e.createElement("span",Ce,Pe,we,Te,e.createElement(o,null)))):void 0})));A.displayName="FileUpload";export{A as FileUpload};
