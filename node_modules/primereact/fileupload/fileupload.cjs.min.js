"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/api"),n=require("primereact/button"),r=require("primereact/messages"),l=require("primereact/progressbar"),o=require("primereact/ripple"),a=require("primereact/utils"),i=require("primereact/componentbase"),s=require("primereact/icons/plus"),c=require("primereact/icons/upload"),u=require("primereact/icons/times");function p(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var m=p(e);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){if("object"!==f(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function y(e){var t=d(e,"string");return"symbol"===f(t)?t:String(t)}function b(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e){if(Array.isArray(e))return g(e)}function E(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function O(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function S(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e){return h(e)||E(e)||O(e)||S()}function N(e){throw new TypeError('"'+e+'" is read-only')}function w(e){if(Array.isArray(e))return e}function j(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],s=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){c=!0,l=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}function B(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){return w(e)||j(e,t)||O(e,t)||B()}var U=i.ComponentBase.extend({defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,withCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0}}),T=i.ComponentBase.extend({defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0}}),C=m.memo(m.forwardRef((function(e,t){var n=T.getProps(e),r=T.setMetaData({props:n}).ptm,l=m.useRef(null),o=a.classNames("p-badge p-component",b({"p-badge-no-gutter":a.ObjectUtils.isNotEmpty(n.value)&&1===String(n.value).length,"p-badge-dot":a.ObjectUtils.isEmpty(n.value),"p-badge-lg":"large"===n.size,"p-badge-xl":"xlarge"===n.size},"p-badge-".concat(n.severity),null!==n.severity),n.className);m.useImperativeHandle(t,(function(){return{props:n,getElement:function(){return l.current}}}));var i=a.mergeProps({ref:l,style:n.style,className:o},T.getOtherProps(n),r("root"));return m.createElement("span",i,n.value)})));function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=M(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function M(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}C.displayName="Badge";var R=m.memo(m.forwardRef((function(e,i){var p=U.getProps(e),f=I(m.useState([]),2),d=f[0],y=f[1],b=I(m.useState([]),2),g=b[0],h=b[1],E=I(m.useState(0),2),O=E[0],S=E[1],w=I(m.useState(!1),2),j=w[0],B=w[1],T=I(m.useState(!1),2),D=T[0],M=T[1],x=U.setMetaData({props:p,state:{progress:O,uploading:D,uploadedFiles:d,files:g,focused:j}}).ptm,R=m.useRef(null),L=m.useRef(null),A=m.useRef(null),k=m.useRef(!1),q=m.useRef(0),_=a.ObjectUtils.isNotEmpty(g),H=a.ObjectUtils.isNotEmpty(d),X=p.disabled||D,J=p.chooseLabel||p.chooseOptions.label||t.localeOption("choose"),V=p.uploadLabel||p.uploadOptions.label||t.localeOption("upload"),K=p.cancelLabel||p.cancelOptions.label||t.localeOption("cancel"),Y=X||p.fileLimit&&p.fileLimit<=g.length+q,W=X||!_,$=X||!_,G=function(e){return/^image\//.test(e.type)},Z=function(e,t){ee();var n=P(g),r=g[t];n.splice(t,1),h(n),p.onRemove&&p.onRemove({originalEvent:e,file:r})},Q=function(e,t){ee();var n=P(d),r=g[t];n.splice(t,1),y(n),p.onRemove&&p.onRemove({originalEvent:e,file:r})},ee=function(){R.current&&(R.current.value="")},te=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},ne=function(e){if(!p.onBeforeSelect||!1!==p.onBeforeSelect({originalEvent:e,files:g}))if("drop"!==e.type&&le()&&k.current)k.current=!1;else{var t=[];p.multiple&&(t=g?P(g):[]);for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0;r<n.length;r++){var l=n[r];!re(l)&&oe(l)&&(G(l)&&(l.objectURL=window.URL.createObjectURL(l)),t.push(l))}h(t),a.ObjectUtils.isNotEmpty(t)&&p.auto&&ae(t),p.onSelect&&p.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&le()?R.current&&(k.current=!0,R.current.value=""):ee(),"basic"===p.mode&&t.length>0&&(R.current.style.display="none")}},re=function(e){return g.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},le=function(){return!!window.MSInputMethodContext&&!!document.documentMode},oe=function(e){if(p.maxFileSize&&e.size>p.maxFileSize){var t={severity:"error",summary:p.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:p.invalidFileSizeMessageDetail.replace("{0}",te(p.maxFileSize)),sticky:!0};return"advanced"===p.mode&&L.current.show(t),p.onValidationFail&&p.onValidationFail(e),!1}return!0},ae=function(e){if((e=e||g)&&e.nativeEvent&&(e=g),p.customUpload)p.fileLimit&&N("uploadedFileCount"),p.uploadHandler&&p.uploadHandler({files:e,options:{clear:ie,props:p}});else{M(!0);var t=new XMLHttpRequest,n=new FormData;p.onBeforeUpload&&p.onBeforeUpload({xhr:t,formData:n});var r,l=z(e);try{for(l.s();!(r=l.n()).done;){var o=r.value;n.append(p.name,o,o.name)}}catch(e){l.e(e)}finally{l.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);S(t),p.onProgress&&p.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(S(0),M(!1),t.status>=200&&t.status<300?(p.fileLimit&&N("uploadedFileCount"),p.onUpload&&p.onUpload({xhr:t,files:e})):p.onError&&p.onError({xhr:t,files:e}),y((function(t){return[].concat(P(t),P(e))})),ie())},t.open("POST",p.url,!0),p.onBeforeSend&&p.onBeforeSend({xhr:t,formData:n}),t.withCredentials=p.withCredentials,t.send(n)}},ie=function(){h([]),M(!1),p.onClear&&p.onClear(),ee()},se=function(){R.current.click()},ce=function(){B(!0)},ue=function(){B(!1)},pe=function(e){13===e.which&&se()},me=function(e){if(!p.disabled&&(a.DomHandler.removeClass(A.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!p.onBeforeDrop||!1!==p.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(p.multiple||a.ObjectUtils.isEmpty(g)&&t&&1===t.length)&&ne(e)}},fe=function(){!X&&_?ae():R.current.click()};m.useImperativeHandle(i,(function(){return{props:p,upload:ae,clear:ie,formatSize:te,onFileSelect:ne,getInput:function(){return R.current},getContent:function(){return A.current},getFiles:function(){return g},setFiles:function(e){return h(e||[])}}}));var de,ye,be,ve,ge,he,Ee,Oe,Se,Pe,Ne,we,je=function(e,t,n){"warning"===t.severity?Z(e,n):Q(e,n)},Be=function(e,t,r){var l=e.name+e.type+e.size,o=a.mergeProps({role:"presentation",className:"p-fileupload-file-thumbnail",src:e.objectURL,width:p.previewWidth},x("thumbnail")),i=G(e)?m.createElement("img",v({},o,{alt:e.name})):null,s=a.mergeProps(x("details")),c=a.mergeProps(x("fileSize")),f=a.mergeProps({className:"p-fileupload-filename"},x("fileName")),d=a.mergeProps(x("actions")),y=m.createElement("div",f,e.name),b=m.createElement("div",c,te(e.size)),g=m.createElement("div",s,m.createElement("div",f," ",e.name),m.createElement("span",c,te(e.size)),m.createElement(C,{className:"p-fileupload-file-badge",value:r.value,severity:r.severity,pt:x("badge")})),h=m.createElement("div",d,m.createElement(n.Button,{type:"button",icon:p.removeIcon||m.createElement(u.TimesIcon,null),text:!0,rounded:!0,severity:"danger",onClick:function(e){return je(e,r,t)},disabled:X,pt:x("removeButton")})),E=m.createElement(m.Fragment,null,i,g,h);if(p.itemTemplate){var O={onRemove:function(e){return Z(e,t)},previewElement:i,fileNameElement:y,sizeElement:b,removeElement:h,formatSize:te(e.size),element:E,index:t,props:p};E=a.ObjectUtils.getJSXElement(p.itemTemplate,e,O)}var S=a.mergeProps({key:l,className:"p-fileupload-row"},x("file"));return m.createElement("div",S,E)},Ie=function(){var e={severity:"success",value:"Completed"},t=d&&d.map((function(t,n){return Be(t,n,e)}));return m.createElement("div",null,t)};return"advanced"===p.mode?function(){var e,t,i,f,d,y,b,h,E,S,P,N,w,B,I,T,C,D,z,M,k=a.classNames("p-fileupload p-fileupload-advanced p-component",p.className),q=a.classNames("p-fileupload-buttonbar",p.headerClassName),G=a.classNames("p-fileupload-content",p.contentClassName),Z=(t=(e=p.chooseOptions).style,i=e.icon,d=a.classNames("p-button p-fileupload-choose p-component",{"p-disabled":X,"p-focus":j,"p-button-icon-only":f=e.iconOnly},e.className),y=a.classNames("p-button-icon p-clickable",{"p-button-icon-left":!f}),b=a.mergeProps({className:"p-button-label p-clickable"},x("chooseButtonLabel")),h=f?m.createElement("span",v({},b,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):m.createElement("span",b,J),E=a.mergeProps({ref:R,type:"file",onChange:function(e){return ne(e)},multiple:p.multiple,accept:p.accept,disabled:Y},x("input")),S=m.createElement("input",E),P=a.mergeProps({className:y},x("chooseIcon")),N=a.IconUtils.getJSXIcon(i||m.createElement(s.PlusIcon,P),F({},P),{props:p}),w=a.mergeProps({className:d,style:t,onClick:se,onKeyDown:function(e){return pe(e)},onFocus:ce,onBlur:ue,tabIndex:0},x("chooseButton")),m.createElement("span",w,S,N,h,m.createElement(o.Ripple,null))),Q=!p.emptyTemplate||_||H?null:a.ObjectUtils.getJSXElement(p.emptyTemplate,p);if(!p.auto){var ee=p.uploadOptions,te=p.cancelOptions,re=ee.iconOnly?"":V,le=te.iconOnly?"":K,oe=a.classNames("p-button-icon p-c",{"p-button-icon-left":!ee.iconOnly}),fe=a.mergeProps({className:oe},x("uploadIcon")),de=a.IconUtils.getJSXIcon(ee.icon||m.createElement(c.UploadIcon,fe),F({},fe),{props:p}),ye=a.classNames("p-button-icon p-c",{"p-button-icon-left":!te.iconOnly}),be=a.mergeProps({className:ye},x("cancelIcon")),ve=a.IconUtils.getJSXIcon(te.icon||m.createElement(u.TimesIcon,be),F({},be),{props:p});B=m.createElement(n.Button,{type:"button",label:re,icon:de,onClick:ae,disabled:W,style:ee.style,className:ee.className,pt:x("uploadButton")}),I=m.createElement(n.Button,{type:"button",label:le,icon:ve,onClick:ie,disabled:$,style:te.style,className:te.className,pt:x("cancelButton")})}_&&(z={severity:"warning",value:"Pending"},M=g.map((function(e,t){return Be(e,t,z)})),T=m.createElement("div",null,M),D=p.progressBarTemplate?a.ObjectUtils.getJSXElement(p.progressBarTemplate,p):m.createElement(l.ProgressBar,{value:O,showValue:!1,pt:x("progressbar")})),H&&(C=Ie());var ge=a.mergeProps({className:q,style:p.headerStyle},x("buttonbar")),he=m.createElement("div",ge,Z,B,I);p.headerTemplate&&(he=a.ObjectUtils.getJSXElement(p.headerTemplate,{className:q,chooseButton:Z,uploadButton:B,cancelButton:I,element:he,props:p}));var Ee=a.mergeProps({id:p.id,className:k,style:p.style},U.getOtherProps(p),x("root")),Oe=a.mergeProps({ref:A,className:G,style:p.contentStyle,onDragEnter:function(e){return t=e,void(X||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()));var t},onDragOver:function(e){return t=e,void(X||(t.dataTransfer.dropEffect="copy",a.DomHandler.addClass(A.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault()));var t},onDragLeave:function(e){return t=e,void(X||(t.dataTransfer.dropEffect="copy",a.DomHandler.removeClass(A.current,"p-fileupload-highlight")));var t},onDrop:function(e){return me(e)}},x("content"));return m.createElement("div",Ee,he,m.createElement("div",Oe,D,m.createElement(r.Messages,{ref:L}),_?T:null,H?C:null,Q))}():"basic"===p.mode?(de=p.chooseOptions,ye=a.classNames("p-fileupload p-fileupload-basic p-component",p.className),be=a.classNames("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":_,"p-disabled":X,"p-focus":j},de.className),ve=a.mergeProps({className:"p-button-label p-clickable"},x("label")),ge=de.iconOnly?m.createElement("span",v({},ve,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):m.createElement("span",ve,J),he=p.auto?ge:m.createElement("span",ve,_?g[0].name:ge),Ee=a.classNames("p-button-icon",{"p-button-icon-left":!de.iconOnly}),Oe=a.mergeProps({className:Ee},x("chooseIcon")),Se=a.IconUtils.getJSXIcon(de.icon?de.icon:de.icon||_&&!p.auto?!de.icon&&_&&!p.auto&&m.createElement(c.UploadIcon,Oe):m.createElement(s.PlusIcon,Oe),F({},Oe),{props:p,hasFiles:_}),Pe=!_&&m.createElement("input",{ref:R,type:"file",accept:p.accept,multiple:p.multiple,disabled:X,onChange:ne}),Ne=a.mergeProps({className:ye,style:p.style},U.getOtherProps(p),x("root")),we=a.mergeProps({className:be,style:de.style,tabIndex:0,onMouseUp:fe,onKeyDown:function(e){return pe(e)},onFocus:ce,onBlur:ue},U.getOtherProps(p),x("basicButton")),m.createElement("div",Ne,m.createElement(r.Messages,{ref:L,pt:x("message")}),m.createElement("span",we,Se,he,Pe,m.createElement(o.Ripple,null)))):void 0})));R.displayName="FileUpload",exports.FileUpload=R;
